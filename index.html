<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天机 · 洞察天机，顺应天命</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cinnabar: '#C41E3A',
                        gold: '#D4AF37',
                        ink: '#1A1A1A',
                        bronze: '#CD7F32',
                        jade: '#00A86B',
                        vermilion: '#E34234',
                        obsidian: '#0B0B0B',
                        parchment: '#F5E6D3',
                        mystic: '#2D1B4E',
                        chaos: '#1A0A2E',
                    },
                    fontFamily: {
                        ancient: ['Ma Shan Zheng', 'cursive'],
                        seal: ['ZCOOL XiaoWei', 'serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'ZCOOL XiaoWei', serif;
            background: radial-gradient(ellipse at center, #1a0a0a 0%, #0a0505 100%);
            overflow-x: hidden;
        }
        
        .ancient-font { font-family: 'Ma Shan Zheng', cursive; }
        
        /* 动画定义 */
        @keyframes chaosToOrder { 0% { opacity: 0; filter: blur(50px) rotate(0deg); transform: scale(2); } 100% { opacity: 1; filter: blur(0) rotate(360deg); transform: scale(1); } }
        @keyframes floatRandom { 0% { transform: translate(0, 0) rotate(0deg); } 25% { transform: translate(20px, -30px) rotate(90deg); } 50% { transform: translate(-10px, 20px) rotate(180deg); } 75% { transform: translate(30px, 10px) rotate(270deg); } 100% { transform: translate(0, 0) rotate(360deg); } }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 30px rgba(212, 175, 55, 0.4); } 50% { box-shadow: 0 0 60px rgba(212, 175, 55, 0.8); } }
        @keyframes rotateBagua { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes drift { 0% { transform: translateY(0) translateX(0); } 50% { transform: translateY(-20px) translateX(10px); } 100% { transform: translateY(0) translateX(0); } }
        
        .chaos-enter { animation: chaosToOrder 3s ease-out forwards; }
        .float-random { animation: floatRandom 20s ease-in-out infinite; }
        .pulse-glow { animation: pulseGlow 3s ease-in-out infinite; }
        .bagua-rotate { animation: rotateBagua 60s linear infinite; }
        .star { animation: twinkle 3s ease-in-out infinite; }
        .slide-in { animation: slideIn 0.6s ease-out forwards; }
        .drift { animation: drift 10s ease-in-out infinite; }
        
        /* 玻璃态 */
        .glass {
            background: rgba(26, 10, 10, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(212, 175, 55, 0.15);
        }
        
        /* 提示框样式 */
        .tooltip {
            position: relative;
            cursor: pointer;
            border-bottom: 1px dashed rgba(212, 175, 55, 0.5);
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .tooltip-text {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            z-index: 100;
            background-color: rgba(0, 0, 0, 0.95);
            color: #F5E6D3;
            text-align: left;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #D4AF37;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            width: 220px;
            font-size: 12px;
            line-height: 1.4;
            transition: opacity 0.3s;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
        }
        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #D4AF37 transparent transparent transparent;
        }

        /* 按钮图案 */
        .jade-pendant {
            position: relative;
            background: linear-gradient(135deg, rgba(0, 168, 107, 0.2), rgba(212, 175, 55, 0.2));
            clip-path: polygon(20% 0%, 80% 0%, 100% 20%, 100% 80%, 80% 100%, 20% 100%, 0% 80%, 0% 20%);
            transition: all 0.4s ease;
        }
        .jade-pendant:hover { background: linear-gradient(135deg, rgba(0, 168, 107, 0.4), rgba(212, 175, 55, 0.4)); transform: translateY(-5px); box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3); }
        
        /* 滚动条 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1a0a0a; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #D4AF37, #8B6914); border-radius: 3px; }
        
        /* 文字发光 */
        .text-glow { text-shadow: 0 0 10px rgba(212, 175, 55, 0.5), 0 0 20px rgba(212, 175, 55, 0.3); }
    </style>
</head>
<body class="min-h-screen text-parchlet">

    <!-- ========== 混沌初开入口 ========== -->
    <div id="chaosEntry" class="fixed inset-0 z-50 flex items-center justify-center bg-chaos overflow-hidden">
        <!-- 混沌粒子背景 -->
        <div id="chaosParticles" class="absolute inset-0"></div>
        
        <!-- 动态符文与图形 -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <!-- 随机漂浮的八卦符号 -->
            <div class="absolute text-gold/20 text-6xl float-random" style="top: 10%; left: 20%; animation-duration: 25s;">☰</div>
            <div class="absolute text-gold/20 text-4xl float-random" style="top: 80%; left: 70%; animation-duration: 18s; animation-delay: -5s;">☷</div>
            <div class="absolute text-gold/20 text-5xl float-random" style="top: 40%; left: 80%; animation-duration: 22s; animation-delay: -2s;">☵</div>
            <div class="absolute text-gold/20 text-3xl float-random" style="top: 60%; left: 10%; animation-duration: 20s; animation-delay: -8s;">☲</div>
            <!-- 随机漂浮的古文 -->
            <div class="absolute text-jade/10 text-2xl float-random" style="top: 20%; left: 60%; animation-duration: 30s;">道</div>
            <div class="absolute text-jade/10 text-3xl float-random" style="top: 70%; left: 30%; animation-duration: 28s; animation-delay: -10s;">玄</div>
        </div>

        <!-- 核心太极区域 -->
        <div id="coreBagua" class="relative chaos-enter flex items-center justify-center">
            <!-- 外层光晕 -->
            <div class="absolute w-96 h-96 rounded-full pulse-glow"></div>
            
            <!-- 旋转八卦环 -->
            <div class="absolute w-80 h-80 bagua-rotate">
                <svg viewBox="0 0 200 200" class="w-full h-full">
                    <circle cx="100" cy="100" r="98" fill="none" stroke="#D4AF37" stroke-width="1" opacity="0.6"/>
                    <text x="100" y="12" text-anchor="middle" fill="#D4AF37" font-size="18" class="ancient-font">☰</text>
                    <text x="170" y="38" text-anchor="middle" fill="#D4AF37" font-size="18" class="ancient-font">☱</text>
                    <text x="195" y="105" text-anchor="middle" fill="#D4AF37" font-size="18" class="ancient-font">☲</text>
                    <text x="170" y="175" text-anchor="middle" fill="#D4AF37" font-size="18" class="ancient-font">☳</text>
                    <text x="100" y="198" text-anchor="middle" fill="#D4AF37" font-size="18" class="ancient-font">☷</text>
                    <text x="30" y="175" text-anchor="middle" fill="#D4AF37" font-size="18" class="ancient-font">☶</text>
                    <text x="5" y="105" text-anchor="middle" fill="#D4AF37" font-size="18" class="ancient-font">☵</text>
                    <text x="30" y="38" text-anchor="middle" fill="#D4AF37" font-size="18" class="ancient-font">☴</text>
                </svg>
            </div>

            <!-- 核心太极图 -->
            <div class="absolute w-48 h-48 rounded-full overflow-hidden breathe">
                <svg viewBox="0 0 100 100" class="w-full h-full">
                    <circle cx="50" cy="50" r="50" fill="#0B0B0B"/>
                    <path d="M50 0 A50 50 0 0 1 50 100 A25 25 0 0 1 50 50 A25 25 0 0 0 50 0" fill="#D4AF37"/>
                    <circle cx="50" cy="25" r="8" fill="#0B0B0B"/>
                    <circle cx="50" cy="75" r="8" fill="#D4AF37"/>
                </svg>
            </div>

            <!-- 进入按钮 -->
            <button onclick="enterApp()" class="absolute inset-0 flex items-center justify-center group z-10">
                <div class="relative">
                    <div class="absolute inset-0 bg-gold/20 rounded-full blur-xl group-hover:bg-gold/40 transition-all duration-500 scale-0 group-hover:scale-150"></div>
                    <div class="relative px-10 py-5 bg-gradient-to-br from-gold/40 to-bronze/40 rounded-full border-2 border-gold/60 backdrop-blur-sm group-hover:border-gold transition-all duration-300">
                        <span class="ancient-font text-3xl text-gold text-glow">洞察天机</span>
                    </div>
                </div>
            </button>
        </div>
        
        <!-- 底部文字 -->
        <div class="absolute bottom-8 text-center chaos-enter" style="animation-delay: 1.5s;">
            <h1 class="ancient-font text-5xl md:text-6xl text-gold text-glow mb-3">天 机</h1>
            <p class="text-bronze/70 tracking-widest text-sm">混沌初开 · 道法自然 · 顺应天命</p>
        </div>
    </div>

    <!-- ========== 主界面 ========== -->
    <div id="mainApp" class="hidden min-h-screen">
        <!-- 动态背景层 -->
        <div id="bgStars" class="fixed inset-0 pointer-events-none z-0"></div>
        
        <!-- 两侧动态装饰 -->
        <div class="fixed left-0 top-0 bottom-0 w-20 overflow-hidden pointer-events-none z-0 opacity-30">
            <div class="absolute text-gold/20 text-6xl drift" style="top: 20%; animation-delay: 0s;">☰</div>
            <div class="absolute text-jade/20 text-5xl drift" style="top: 50%; animation-delay: 2s;">☵</div>
            <div class="absolute text-cinnabar/20 text-4xl drift" style="top: 80%; animation-delay: 4s;">☲</div>
        </div>
        <div class="fixed right-0 top-0 bottom-0 w-20 overflow-hidden pointer-events-none z-0 opacity-30">
            <div class="absolute text-gold/20 text-6xl drift" style="top: 30%; animation-delay: 1s;">☷</div>
            <div class="absolute text-jade/20 text-5xl drift" style="top: 60%; animation-delay: 3s;">☴</div>
            <div class="absolute text-cinnabar/20 text-4xl drift" style="top: 90%; animation-delay: 5s;">☳</div>
        </div>

        <!-- 顶部导航 -->
        <header class="relative z-20 glass sticky top-0">
            <div class="container mx-auto px-4 py-3 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-gold/20 flex items-center justify-center pulse-glow">
                        <i class="fas fa-yin-yang text-gold text-lg"></i>
                    </div>
                    <h1 class="ancient-font text-2xl text-gold text-glow">天机</h1>
                </div>
                <div class="text-right">
                    <div id="headerDate" class="text-parchment text-sm"></div>
                    <div id="headerLunar" class="text-bronze text-xs"></div>
                </div>
            </div>
        </header>

        <!-- 主内容 -->
        <main class="relative z-10 container mx-auto px-4 py-6">
            
            <!-- 今日概览 -->
            <section class="mb-8 slide-in">
                <div class="glass rounded-3xl p-6 pulse-glow">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center">
                        <div class="text-center md:border-r border-gold/20">
                            <div id="todaySolar" class="ancient-font text-3xl text-gold text-glow"></div>
                            <div id="todayLunar" class="text-bronze text-sm mt-1"></div>
                        </div>
                        <div class="text-center md:border-r border-gold/20">
                            <div class="text-bronze text-xs">今日卦象</div>
                            <div id="todayGua" class="ancient-font text-4xl text-gold text-glow my-1"></div>
                            <div id="todayGuaName" class="text-parchment/70 text-sm"></div>
                        </div>
                        <div class="text-center md:border-r border-gold/20">
                            <div class="flex justify-center gap-4">
                                <div>
                                    <div class="text-jade text-xs">宜</div>
                                    <div id="quickYi" class="text-jade/80 text-sm mt-1 flex flex-wrap gap-1 justify-center"></div>
                                </div>
                                <div>
                                    <div class="text-cinnabar text-xs">忌</div>
                                    <div id="quickJi" class="text-cinnabar/80 text-sm mt-1 flex flex-wrap gap-1 justify-center"></div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center">
                            <i class="fas fa-quote-left text-gold/30 text-sm mb-2"></i>
                            <p id="dailyQuote" class="text-parchment/70 text-sm italic"></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 四大模块入口 -->
            <section class="mb-8">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <button onclick="openModule('tianshi')" class="group relative">
                        <div class="jade-pendant w-full h-32 flex items-center justify-center">
                            <div class="text-center">
                                <i class="fas fa-sun text-3xl text-gold mb-2 group-hover:scale-110 transition-transform"></i>
                                <div class="text-gold ancient-font text-xl">天时</div>
                                <div class="text-parchment/50 text-xs mt-1">历法卦象</div>
                            </div>
                        </div>
                    </button>
                    <button onclick="openModule('dili')" class="group relative">
                        <div class="jade-pendant w-full h-32 flex items-center justify-center">
                            <div class="text-center">
                                <i class="fas fa-compass text-3xl text-jade mb-2 group-hover:scale-110 transition-transform"></i>
                                <div class="text-gold ancient-font text-xl">地利</div>
                                <div class="text-parchment/50 text-xs mt-1">风水方位</div>
                            </div>
                        </div>
                    </button>
                    <button onclick="openModule('renhe')" class="group relative">
                        <div class="jade-pendant w-full h-32 flex items-center justify-center">
                            <div class="text-center">
                                <i class="fas fa-users text-3xl text-gold mb-2 group-hover:scale-110 transition-transform"></i>
                                <div class="text-gold ancient-font text-xl">人和</div>
                                <div class="text-parchment/50 text-xs mt-1">命理运势</div>
                            </div>
                        </div>
                    </button>
                    <button onclick="openModule('xuanji')" class="group relative">
                        <div class="jade-pendant w-full h-32 flex items-center justify-center">
                            <div class="text-center">
                                <i class="fas fa-scroll text-3xl text-cinnabar mb-2 group-hover:scale-110 transition-transform"></i>
                                <div class="text-gold ancient-font text-xl">玄机</div>
                                <div class="text-parchment/50 text-xs mt-1">占卜解梦</div>
                            </div>
                        </div>
                    </button>
                </div>
            </section>

            <!-- 知识与文化板块 -->
            <section class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- 太极演化 -->
                <div class="glass rounded-2xl p-6 hover:border-gold/30 transition-all cursor-pointer" onclick="openModule('cosmos')">
                    <h3 class="text-gold text-lg mb-3 ancient-font flex items-center"><i class="fas fa-infinity mr-2"></i> 道法自然</h3>
                    <p class="text-parchment/70 text-sm">太极生两仪，两仪生四象，四象生八卦。探索宇宙生成的奥秘。</p>
                    <div class="mt-3 flex space-x-2">
                        <span class="px-2 py-1 rounded bg-gold/10 text-gold/70 text-xs">太极</span>
                        <span class="px-2 py-1 rounded bg-gold/10 text-gold/70 text-xs">两仪</span>
                        <span class="px-2 py-1 rounded bg-gold/10 text-gold/70 text-xs">四象</span>
                    </div>
                </div>
                <!-- 神话传说 -->
                <div class="glass rounded-2xl p-6 hover:border-gold/30 transition-all cursor-pointer" onclick="openModule('myth')">
                    <h3 class="text-gold text-lg mb-3 ancient-font flex items-center"><i class="fas fa-dragon mr-2"></i> 神话传说</h3>
                    <p class="text-parchment/70 text-sm">盘古开天、女娲补天、夸父逐日。聆听古老文明的声音。</p>
                    <div class="mt-3 flex space-x-2">
                        <span class="px-2 py-1 rounded bg-jade/10 text-jade/70 text-xs">民间故事</span>
                        <span class="px-2 py-1 rounded bg-jade/10 text-jade/70 text-xs">上古神话</span>
                    </div>
                </div>
            </section>

            <!-- 养生与国学 -->
            <section class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="openModule('health')" class="glass rounded-xl p-4 text-center hover:bg-gold/10 transition-all group">
                    <i class="fas fa-heart-pulse text-2xl text-jade mb-2 group-hover:scale-110 transition-transform"></i>
                    <div class="text-gold text-sm">养生之道</div>
                </button>
                <button onclick="openModule('culture')" class="glass rounded-xl p-4 text-center hover:bg-gold/10 transition-all group">
                    <i class="fas fa-book-open text-2xl text-bronze mb-2 group-hover:scale-110 transition-transform"></i>
                    <div class="text-gold text-sm">国学经典</div>
                </button>
                <button onclick="openModule('history')" class="glass rounded-xl p-4 text-center hover:bg-gold/10 transition-all group">
                    <i class="fas fa-landmark text-2xl text-cinnabar mb-2 group-hover:scale-110 transition-transform"></i>
                    <div class="text-gold text-sm">历史今日</div>
                </button>
                <button onclick="openModule('festival')" class="glass rounded-xl p-4 text-center hover:bg-gold/10 transition-all group">
                    <i class="fas fa-calendar-day text-2xl text-azure mb-2 group-hover:scale-110 transition-transform"></i>
                    <div class="text-gold text-sm">节日节气</div>
                </button>
            </section>
        </main>

        <!-- 页脚 -->
        <footer class="relative z-10 text-center py-6 border-t border-gold/10 mt-8">
            <p class="text-gold/40 text-sm">天机 · 传承千年智慧</p>
        </footer>
    </div>

    <!-- ========== 模态框 ========== -->
    <div id="modalOverlay" class="fixed inset-0 z-50 hidden modal-overlay flex items-center justify-center p-4 overflow-y-auto" style="background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);">
        <div id="modalContent" class="glass rounded-3xl w-full max-w-5xl my-8 overflow-hidden border border-gold/20">
            <div class="flex items-center justify-between p-6 border-b border-gold/20">
                <h2 id="modalTitle" class="ancient-font text-2xl text-gold text-glow"></h2>
                <button onclick="closeModal()" class="w-10 h-10 rounded-full bg-gold/10 hover:bg-gold/20 flex items-center justify-center transition-all">
                    <i class="fas fa-times text-gold"></i>
                </button>
            </div>
            <div id="modalBody" class="p-6 overflow-y-auto" style="max-height: 70vh;"></div>
        </div>
    </div>

    <script>
        // ==================== 数据定义 ====================
        const tianGan = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
        const diZhi = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
        const shengXiao = ['鼠', '牛', '虎', '兔', '龙', '蛇', '马', '羊', '猴', '鸡', '狗', '猪'];
        const lunarMonths = ['正', '二', '三', '四', '五', '六', '七', '八', '九', '十', '冬', '腊'];
        const lunarDays = ['初一', '初二', '初三', '初四', '初五', '初六', '初七', '初八', '初九', '初十',
                          '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十',
                          '廿一', '廿二', '廿三', '廿四', '廿五', '廿六', '廿七', '廿八', '廿九', '三十'];
        const bagua = ['乾', '坤', '震', '巽', '坎', '离', '艮', '兑'];
        const baguaName = { '乾': '乾为天', '坤': '坤为地', '震': '震为雷', '巽': '巽为风', '坎': '坎为水', '离': '离为火', '艮': '艮为山', '兑': '兑为泽' };
        const guaCi = { '乾': '天行健，君子以自强不息。', '坤': '地势坤，君子以厚德载物。', '震': '震惊百里，不丧匕鬯。', '巽': '随风巽，君子以申命行事。', '坎': '水流而不盈，行险而不失其信。', '离': '明两作离，大人以继明照于四方。', '艮': '时止则止，时行则行。', '兑': '丽泽兑，君子以朋友讲习。' };
        
        // 术语解释库
        const termsExplanation = {
            '纳财': '指购置产业、进货、收账、收租、讨债、贷款、五谷入仓等。',
            '祈福': '祈求神明降福或设醮还愿之事。',
            '祭祀': '指祠堂之祭祀、即拜祭祖先或庙祀神明等事。',
            '嫁娶': '男娶女嫁，举行结婚大典的吉日。',
            '开市': '商品行号开张做生意。包括年头初开始营业或开工等事。',
            '动土': '建筑时、第一次动起锄头挖土。',
            '安床': '指安置睡床卧铺之意。',
            '入宅': '即迁入新宅、所谓“新居落成典礼”也。',
            '道经': '道教经典的统称，包含《道德经》、《南华经》等，阐述宇宙本源与修身治国之道。',
            '太极': '天地未分之前，元气混而为一，即是太极。太极动而生阳，静而生阴。',
            '两仪': '即阴阳。太极生两仪，一阴一阳，代表天地、昼夜、男女等对立统一的事物。',
            '四象': '即太阳、太阴、少阳、少阴。在天为四季（春夏秋冬），在地为四方（东南西北）。',
        };

        const yiItems = ['祭祀', '祈福', '求嗣', '开光', '出行', '解除', '纳采', '冠笄', '嫁娶', '纳婿', '安床', '移徙', '入宅', '安香', '拆卸', '动土', '挂匾', '开市', '立券', '纳财'];
        const jiItems = ['嫁娶', '安葬', '出行', '动土', '开市', '入宅', '移徙', '祭祀', '祈福', '开光'];
        
        const quotes = [
            { text: '积善之家，必有余庆。', source: '《易经》' },
            { text: '天行健，君子以自强不息。', source: '《易经》' },
            { text: '地势坤，君子以厚德载物。', source: '《易经》' },
            { text: '道可道，非常道。', source: '《道德经》' },
            { text: '上善若水，水善利万物而不争。', source: '《道德经》' }
        ];

        const dreamDict = [
            { keyword: '水', meaning: '梦见大水主财运，清水吉，浊水凶。', detail: '水在梦中象征财富和情感。大水滔滔往往预示着大财将至，但也需注意情绪波动。' },
            { keyword: '龙', meaning: '梦见龙主大吉，事业腾飞之兆。', detail: '龙为祥瑞之兽，梦见龙飞腾预示事业有成，贵人相助，是极佳的吉兆。' },
            { keyword: '蛇', meaning: '梦见蛇主变化，或有口舌之争。', detail: '蛇又称小龙，梦见蛇可能预示生活中将有变化，或需防范小人。' },
            { keyword: '火', meaning: '梦见火主兴旺，但需防口舌。', detail: '火代表热情与能量，红火预示兴旺，但也要注意控制脾气，避免争执。' },
            { keyword: '死人', meaning: '梦见死人往往反主生，预示新开始。', detail: '不必惊慌，梦见死亡往往象征旧事物的结束，新生活的开始。' },
            { keyword: '掉牙', meaning: '梦见掉牙预示长辈健康或人际关系变化。', detail: '传统解梦认为掉牙与骨肉分离有关，宜多关心家中长辈健康。' }
        ];

        const myths = [
            { title: '盘古开天', content: '传说太古时候，天地不分，像个混沌的大鸡蛋。盘古在其中孕育了一万八千年，醒来后用斧头劈开天地。阳清为天，阴浊为地。盘古死后，气成风云，声为雷霆，左眼为日，右眼为月，四肢五体为四极五岳，血液为江河，筋脉为地里，肌肉为田土...' },
            { title: '女娲补天', content: '远古时代，天柱折断，天塌地陷。女娲娘娘炼五色石以补苍天，断鳌足以立四极，杀黑龙以济冀州，积芦灰以止淫水。于是地平天成，不改旧物。' },
            { title: '夸父逐日', content: '夸父与日逐走，入日；渴，欲得饮，饮于河、渭；河、渭不足，北饮大泽。未至，道渴而死。弃其杖，化为邓林。' }
        ];

        const classics = [
            { name: '《道德经》', desc: '春秋时期老子（李耳）的哲学作品，又称《道德真经》，是道家哲学思想的重要来源。', quote: '道可道，非常道；名可名，非常名。' },
            { name: '《易经》', desc: '阐述天地世间万象变化的古老经典，是博大精深的辩证法哲学书。被誉为“群经之首”。', quote: '天行健，君子以自强不息。' },
            { name: '《黄帝内经》', desc: '中国最早的医学典籍，分《灵枢》、《素问》两部分，奠定了人体生理、病理、诊断、治疗的基础。', quote: '法于阴阳，和于术数。' }
        ];

        const lunarInfo = [0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,0x06ca0,0x0b550,0x15355,0x04da0,0x0a5b0,0x14573,0x052b0,0x0a9a8,0x0e950,0x06aa0,0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b6a0,0x195a6,0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0,0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,0x05aa0,0x076a3,0x096d0,0x04afb,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0,0x14b63,0x09370,0x049f8,0x04970,0x064b0,0x168a6,0x0ea50,0x06b20,0x1a6c4,0x0aae0,0x0a2e0,0x0d2e3,0x0c960,0x0d557,0x0d4a0,0x0da50,0x05d55,0x056a0,0x0a6d0,0x055d4,0x052d0,0x0a9b8,0x0a950,0x0b4a0,0x0b6a6,0x0ad50,0x055a0,0x0aba4,0x0a5b0,0x052b0,0x0b273,0x06930,0x07337,0x06aa0,0x0ad50,0x14b55,0x04b60,0x0a570,0x054e4,0x0d160,0x0e968,0x0d520,0x0daa0,0x16aa6,0x056d0,0x04ae0,0x0a9d4,0x0a2d0,0x0d150,0x0f252,0x0d520];

        // ==================== 工具函数 ====================
        function getLunarMonthDays(year, month) { return (lunarInfo[year - 1900] & (0x10000 >> month)) ? 30 : 29; }
        function getLunarYearDays(year) { let sum = 348; for (let i = 0x8000; i > 0x8; i >>= 1) sum += (lunarInfo[year - 1900] & i) ? 1 : 0; return sum + getLeapMonthDays(year); }
        function getLeapMonth(year) { return lunarInfo[year - 1900] & 0xf; }
        function getLeapMonthDays(year) { return getLeapMonth(year) ? ((lunarInfo[year - 1900] & 0x10000) ? 30 : 29) : 0; }
        function solarToLunar(year, month, day) {
            const baseDate = new Date(1900, 0, 31); const targetDate = new Date(year, month - 1, day);
            let offset = Math.floor((targetDate - baseDate) / 86400000);
            let lunarYear = 1900, lunarMonth = 1, lunarDay = 1, isLeap = false;
            while (lunarYear < 2100 && offset > 0) { const yearDays = getLunarYearDays(lunarYear); if (offset < yearDays) break; offset -= yearDays; lunarYear++; }
            const leapMonth = getLeapMonth(lunarYear);
            for (let i = 1; i <= 12; i++) {
                let monthDays;
                if (leapMonth > 0 && i === leapMonth + 1 && !isLeap) { monthDays = getLeapMonthDays(lunarYear); isLeap = true; i--; }
                else { monthDays = getLunarMonthDays(lunarYear, i); isLeap = false; }
                if (offset < monthDays) { lunarMonth = i; break; } offset -= monthDays;
            }
            lunarDay = offset + 1; return { year: lunarYear, month: lunarMonth, day: lunarDay, isLeap: isLeap };
        }
        function getGanZhiYear(year) { return tianGan[(year - 4) % 10] + diZhi[(year - 4) % 12]; }
        function getZodiac(year) { return shengXiao[(year - 4) % 12]; }
        function generateYiJi(seed) {
            const random = (s) => Math.sin(s) * 10000 - Math.floor(Math.sin(s) * 10000);
            return {
                yi: [...yiItems].sort(() => random(seed + 2) - 0.5).slice(0, Math.floor(random(seed) * 5) + 4),
                ji: [...jiItems].sort(() => random(seed + 3) - 0.5).slice(0, Math.floor(random(seed + 1) * 4) + 2)
            };
        }
        function getTodayGua(date) { const seed = date.getFullYear() * 10000 + (date.getMonth() + 1) * 100 + date.getDate(); return bagua[Math.abs(Math.floor((Math.sin(seed) * 10000) % 8))]; }
        
        // 创建提示框HTML
        function createTooltip(text) {
            const term = termsExplanation[text];
            if (term) {
                return `<span class="tooltip">${text}<span class="tooltip-text">${term}</span></span>`;
            }
            return text;
        }

        // ==================== 动态效果 ====================
        function createParticles(containerId, count = 100) {
            const container = document.getElementById(containerId);
            if (!container) return; container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'star absolute rounded-full';
                const size = Math.random() * 3 + 1;
                particle.style.cssText = `width: ${size}px; height: ${size}px; left: ${Math.random() * 100}%; top: ${Math.random() * 100}%; background: hsl(${Math.random() > 0.7 ? '45' : '0'}, 70%, 80%); animation-delay: ${Math.random() * 3}s;`;
                container.appendChild(particle);
            }
        }

        // ==================== 入口逻辑 ====================
        function enterApp() {
            const chaos = document.getElementById('chaosEntry');
            const main = document.getElementById('mainApp');
            chaos.style.transition = 'opacity 1s';
            chaos.style.opacity = '0';
            setTimeout(() => {
                chaos.classList.add('hidden');
                main.classList.remove('hidden');
                main.style.animation = 'fadeIn 1s ease-out';
                createParticles('bgStars', 150);
                updateMainInfo();
            }, 500);
        }

        function updateMainInfo() {
            const today = new Date();
            const lunar = solarToLunar(today.getFullYear(), today.getMonth() + 1, today.getDate());
            const yiji = generateYiJi(today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate());
            const gua = getTodayGua(today);

            document.getElementById('headerDate').textContent = `${today.getFullYear()}年${today.getMonth() + 1}月${today.getDate()}日`;
            document.getElementById('headerLunar').textContent = `农历${getGanZhiYear(lunar.year)}年 ${lunarMonths[lunar.month - 1]}月${lunarDays[lunar.day - 1]}`;
            document.getElementById('todaySolar').textContent = `${today.getMonth() + 1}月${today.getDate()}日`;
            document.getElementById('todayLunar').textContent = `${getGanZhiYear(lunar.year)}年 ${lunarMonths[lunar.month - 1]}月${lunarDays[lunar.day - 1]}`;
            document.getElementById('todayGua').textContent = gua;
            document.getElementById('todayGuaName').textContent = baguaName[gua];
            
            // 使用提示框渲染宜忌
            document.getElementById('quickYi').innerHTML = yiji.yi.slice(0, 2).map(y => createTooltip(y)).join(' ');
            document.getElementById('quickJi').innerHTML = yiji.ji.slice(0, 2).map(j => createTooltip(j)).join(' ');
            
            const quoteIndex = (today.getDate()) % quotes.length;
            document.getElementById('dailyQuote').textContent = `"${quotes[quoteIndex].text}"`;
        }

        // ==================== 模态框系统 ====================
        function openModule(moduleName) {
            const overlay = document.getElementById('modalOverlay');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');
            overlay.classList.remove('hidden'); body.scrollTop = 0;
            
            const modules = {
                'tianshi': { title: '天时 · 历法卦象', loader: loadTianshiModule },
                'dili': { title: '地利 · 风水方位', loader: loadDiliModule },
                'renhe': { title: '人和 · 命理运势', loader: loadRenheModule },
                'xuanji': { title: '玄机 · 占卜解梦', loader: loadXuanjiModule },
                'cosmos': { title: '道法自然 · 宇宙演化', loader: loadCosmosModule },
                'myth': { title: '神话传说', loader: loadMythModule },
                'health': { title: '养生之道', loader: loadHealthModule },
                'culture': { title: '国学经典', loader: loadCultureModule },
                'history': { title: '历史今日', loader: loadHistoryModule },
                'festival': { title: '节日节气', loader: loadFestivalModule }
            };
            const mod = modules[moduleName];
            if (mod) { title.textContent = mod.title; mod.loader(body); }
        }

        function closeModal() { document.getElementById('modalOverlay').classList.add('hidden'); }
        document.getElementById('modalOverlay').addEventListener('click', function(e) { if (e.target === this) closeModal(); });

        // ==================== 模块加载器 ====================
        
        // 通用子模块加载
        function loadSubModule(name) {
            const container = document.getElementById('subModuleContent');
            if(!container) return;
            container.innerHTML = '<div class="text-center text-gold/50 py-8"><i class="fas fa-spinner fa-spin text-2xl"></i></div>';
            setTimeout(() => {
                switch(name) {
                    case 'calendar': loadCalendarContent(container); break;
                    case 'fortune': loadFortuneContent(container); break;
                    case 'bazi': loadBaziContent(container); break;
                    case 'name': loadNameContent(container); break;
                    case 'dream': loadDreamContent(container); break;
                    case 'liuyao': loadLiuyaoContent(container); break;
                    case 'tarot': loadTarotContent(container); break;
                    case 'fengshui': loadFengshuiContent(container); break;
                    default: container.innerHTML = '<div class="text-center text-parchment/50 py-8">功能已就绪</div>';
                }
            }, 300);
        }

        function loadTianshiModule(body) {
            body.innerHTML = `<div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <button onclick="loadSubModule('calendar')" class="jade-pendant p-6 text-center hover:scale-105 transition-transform"><i class="fas fa-calendar-alt text-3xl text-gold mb-2"></i><div class="text-gold ancient-font text-lg">万年历</div></button>
                <button onclick="loadSubModule('fortune')" class="jade-pendant p-6 text-center hover:scale-105 transition-transform"><i class="fas fa-star text-3xl text-gold mb-2"></i><div class="text-gold ancient-font text-lg">每日运势</div></button>
                <button onclick="loadSubModule('luckyday')" class="jade-pendant p-6 text-center hover:scale-105 transition-transform"><i class="fas fa-calendar-check text-3xl text-gold mb-2"></i><div class="text-gold ancient-font text-lg">择吉日</div></button>
            </div><div id="subModuleContent" class="mt-6"></div>`;
        }

        function loadDiliModule(body) {
            body.innerHTML = `<div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <button onclick="loadSubModule('fengshui')" class="jade-pendant p-6 text-center hover:scale-105 transition-transform"><i class="fas fa-compass text-3xl text-jade mb-2"></i><div class="text-gold ancient-font text-lg">风水罗盘</div></button>
                <button onclick="loadSubModule('direction')" class="jade-pendant p-6 text-center hover:scale-105 transition-transform"><i class="fas fa-location-arrow text-3xl text-jade mb-2"></i><div class="text-gold ancient-font text-lg">吉神方位</div></button>
            </div><div id="subModuleContent" class="mt-6"></div>`;
        }

        function loadRenheModule(body) {
            body.innerHTML = `<div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <button onclick="loadSubModule('bazi')" class="jade-pendant p-6 text-center hover:scale-105 transition-transform"><i class="fas fa-yin-yang text-3xl text-gold mb-2"></i><div class="text-gold ancient-font text-lg">八字算命</div></button>
                <button onclick="loadSubModule('name')" class="jade-pendant p-6 text-center hover:scale-105 transition-transform"><i class="fas fa-signature text-3xl text-gold mb-2"></i><div class="text-gold ancient-font text-lg">姓名测算</div></button>
            </div><div id="subModuleContent" class="mt-6"></div>`;
        }

        function loadXuanjiModule(body) {
            body.innerHTML = `<div class="grid grid-cols-3 gap-4">
                <button onclick="loadSubModule('dream')" class="jade-pendant p-6 text-center hover:scale-105 transition-transform"><i class="fas fa-moon text-3xl text-gold mb-2"></i><div class="text-gold ancient-font text-lg">解梦</div></button>
                <button onclick="loadSubModule('liuyao')" class="jade-pendant p-6 text-center hover:scale-105 transition-transform"><i class="fas fa-coins text-3xl text-gold mb-2"></i><div class="text-gold ancient-font text-lg">六爻</div></button>
                <button onclick="loadSubModule('tarot')" class="jade-pendant p-6 text-center hover:scale-105 transition-transform"><i class="fas fa-cards text-3xl text-gold mb-2"></i><div class="text-gold ancient-font text-lg">塔罗</div></button>
            </div><div id="subModuleContent" class="mt-6"></div>`;
        }

        function loadCosmosModule(body) {
            body.innerHTML = `
            <div class="space-y-8 text-center">
                <div class="p-6 rounded-2xl bg-gradient-to-br from-chaos to-obsidian border border-gold/30">
                    <div class="text-gold text-2xl ancient-font mb-2">无极生太极</div>
                    <div class="text-parchment/70">天地未判，元气未分，混沌无物，曰无极。静极生动，一气产生，是为太极。</div>
                    <div class="mt-4 text-6xl text-gold/20">☯</div>
                </div>
                <div><i class="fas fa-arrow-down text-gold/50 text-2xl"></i></div>
                <div class="grid grid-cols-2 gap-6">
                    <div class="p-4 rounded-xl bg-gold/10 border border-gold/20">
                        <div class="text-2xl ancient-font text-gold">两仪</div>
                        <div class="text-parchment/60 text-sm mt-2">太极动而生阳，静而生阴。一阴一阳，天地始分。</div>
                        <div class="mt-2 text-3xl">⚊ ⚋</div>
                    </div>
                </div>
                <div><i class="fas fa-arrow-down text-gold/50 text-2xl"></i></div>
                <div class="grid grid-cols-4 gap-4">
                    <div class="p-3 rounded-lg bg-jade/10 border border-jade/20">
                        <div class="text-lg ancient-font text-jade">太阳</div>
                        <div class="text-xs text-parchment/50">⚌</div>
                    </div>
                    <div class="p-3 rounded-lg bg-jade/10 border border-jade/20">
                        <div class="text-lg ancient-font text-jade">少阴</div>
                        <div class="text-xs text-parchment/50">⚍</div>
                    </div>
                    <div class="p-3 rounded-lg bg-jade/10 border border-jade/20">
                        <div class="text-lg ancient-font text-jade">少阳</div>
                        <div class="text-xs text-parchment/50">⚎</div>
                    </div>
                    <div class="p-3 rounded-lg bg-jade/10 border border-jade/20">
                        <div class="text-lg ancient-font text-jade">太阴</div>
                        <div class="text-xs text-parchment/50">⚏</div>
                    </div>
                </div>
                <div><i class="fas fa-arrow-down text-gold/50 text-2xl"></i></div>
                <div class="p-4 rounded-xl bg-obsidian/50 border border-gold/20">
                    <div class="text-xl ancient-font text-gold">八卦</div>
                    <div class="mt-2 flex justify-center space-x-2 text-xl text-gold/70">
                        <span>☰</span><span>☱</span><span>☲</span><span>☳</span><span>☷</span><span>☶</span><span>☵</span><span>☴</span>
                    </div>
                </div>
            </div>`;
        }

        function loadMythModule(body) {
            body.innerHTML = `<div class="space-y-6">
                ${myths.map(m => `
                    <div class="p-6 rounded-xl bg-obsidian/50 border border-gold/20 hover:border-gold/40 transition-all">
                        <h4 class="text-gold text-xl ancient-font mb-3">${m.title}</h4>
                        <p class="text-parchment/70 leading-relaxed text-sm">${m.content}</p>
                    </div>
                `).join('')}
            </div>`;
        }

        function loadHealthModule(body) {
            const today = new Date();
            const season = today.getMonth() >= 2 && today.getMonth() <= 4 ? '春' : today.getMonth() >= 5 && today.getMonth() <= 7 ? '夏' : today.getMonth() >= 8 && today.getMonth() <= 10 ? '秋' : '冬';
            const tips = {
                '春': { organ: '肝', food: '绿色蔬菜、豆芽、枸杞', exercise: '晨起散步、太极拳', avoid: '过度劳累、情绪激动', principle: '春三月，此谓发陈。天地俱生，万物以荣。夜卧早起，广步于庭。' },
                '夏': { organ: '心', food: '苦瓜、绿豆汤、西瓜', exercise: '游泳、慢跑', avoid: '暴晒、贪凉', principle: '夏三月，此谓蕃秀。天地气交，万物华实。夜卧早起，无厌于日。' },
                '秋': { organ: '肺', food: '梨、百合、银耳', exercise: '登山、深呼吸', avoid: '辛辣、熬夜', principle: '秋三月，此谓容平。天气以急，地气以明。早卧早起，与鸡俱兴。' },
                '冬': { organ: '肾', food: '黑芝麻、核桃、羊肉', exercise: '室内运动、泡脚', avoid: '受寒、过度出汗', principle: '冬三月，此谓闭藏。水冰地坼，无扰乎阳。早卧晚起，必待日光。' }
            };
            const t = tips[season];
            body.innerHTML = `
            <div class="text-center mb-6">
                <div class="text-gold text-2xl ancient-font">${season}季养生</div>
                <div class="text-parchment/50 text-xs mt-1">顺应四时，天人合一</div>
            </div>
            <div class="p-4 rounded-xl bg-gold/5 border border-gold/20 mb-6 text-center italic text-parchment/80">"${t.principle}" ——《黄帝内经》</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="p-5 rounded-xl bg-jade/10 border border-jade/30">
                    <div class="text-jade mb-2">重点养护脏腑</div>
                    <div class="text-parchment text-lg">${t.organ}</div>
                </div>
                <div class="p-5 rounded-xl bg-gold/10 border border-gold/30">
                    <div class="text-gold mb-2">推荐食物</div>
                    <div class="text-parchment">${t.food}</div>
                </div>
                <div class="p-5 rounded-xl bg-azure/10 border border-azure/30">
                    <div class="text-azure mb-2">适宜运动</div>
                    <div class="text-parchment">${t.exercise}</div>
                </div>
                <div class="p-5 rounded-xl bg-cinnabar/10 border border-cinnabar/30">
                    <div class="text-cinnabar mb-2">禁忌事项</div>
                    <div class="text-parchment">${t.avoid}</div>
                </div>
            </div>`;
        }

        function loadCultureModule(body) {
            body.innerHTML = `<div class="space-y-6">
                ${classics.map(c => `
                    <div class="p-6 rounded-xl bg-obsidian/50 border border-gold/20 hover:border-gold/40 transition-all">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-gold text-xl ancient-font">${c.name}</h4>
                            <span class="text-xs text-bronze px-2 py-1 rounded bg-bronze/10">经典</span>
                        </div>
                        <p class="text-parchment/70 text-sm mb-3">${c.desc}</p>
                        <div class="p-3 rounded-lg bg-gold/5 border-l-2 border-gold italic text-parchment/80 text-sm">
                            "${c.quote}"
                        </div>
                    </div>
                `).join('')}
            </div>`;
        }

        function loadHistoryModule(body) {
            const events = [ { year: '公元前221年', event: '秦始皇统一六国，建立秦朝。' }, { year: '公元105年', event: '蔡伦改进造纸术，被称为“纸神”。' }, { year: '公元1405年', event: '郑和首次下西洋，开启了伟大的航海时代。' } ];
            body.innerHTML = `<div class="space-y-4">${events.map(e => `<div class="flex items-start p-4 rounded-xl bg-gold/5 border border-gold/10 hover:border-gold/30 transition-all"><div class="w-28 text-bronze text-sm flex-shrink-0">${e.year}</div><div class="text-parchment/80">${e.event}</div></div>`).join('')}</div>`;
        }

        function loadFestivalModule(body) {
            const solarTerms = ['小寒', '大寒', '立春', '雨水', '惊蛰', '春分', '清明', '谷雨', '立夏', '小满', '芒种', '夏至', '小暑', '大暑', '立秋', '处暑', '白露', '秋分', '寒露', '霜降', '立冬', '小雪', '大雪', '冬至'];
            body.innerHTML = `<div class="grid grid-cols-4 gap-3">${solarTerms.map(t => `<div class="p-3 rounded-xl bg-gold/5 border border-gold/20 text-center text-gold text-sm">${t}</div>`).join('')}</div>`;
        }

        // ==================== 具体功能实现 ====================

        // 万年历
        function loadCalendarContent(container) {
            const today = new Date(); const year = today.getFullYear(); const month = today.getMonth();
            const firstDay = new Date(year, month, 1).getDay(); const totalDays = new Date(year, month + 1, 0).getDate();
            let html = `<div class="p-4 rounded-xl bg-obsidian/50 border border-gold/20"><div class="text-center mb-4"><div class="ancient-font text-2xl text-gold">${getGanZhiYear(year)}年</div><div class="text-bronze">${year}年${month + 1}月</div></div><div class="grid grid-cols-7 gap-1 text-center text-sm mb-2"><div class="text-cinnabar">日</div><div class="text-gold/70">一</div><div class="text-gold/70">二</div><div class="text-gold/70">三</div><div class="text-gold/70">四</div><div class="text-gold/70">五</div><div class="text-cinnabar">六</div></div><div class="grid grid-cols-7 gap-1">`;
            for (let i = 0; i < firstDay; i++) html += '<div class="aspect-square"></div>';
            for (let day = 1; day <= totalDays; day++) {
                const isToday = day === today.getDate();
                const lunar = solarToLunar(year, month + 1, day);
                html += `<div class="aspect-square rounded-lg p-1 flex flex-col items-center justify-center cursor-pointer ${isToday ? 'bg-cinnabar/30 border border-cinnabar' : 'bg-obsidian/30 hover:bg-gold/10'}"><span class="text-xs ${isToday ? 'text-gold' : 'text-parchment'}">${day}</span><span class="text-xs text-gold/50">${lunarDays[lunar.day - 1]}</span></div>`;
            }
            html += '</div></div>'; container.innerHTML = html;
        }

        // 运势
        function loadFortuneContent(container) {
            const today = new Date();
            const yiji = generateYiJi(today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate());
            container.innerHTML = `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="p-5 rounded-xl bg-jade/10 border border-jade/30"><div class="text-jade text-lg mb-3">宜</div><div class="flex flex-wrap gap-2">${yiji.yi.map(y => `<span class="px-3 py-1 rounded-lg bg-jade/20 text-jade/90 text-sm">${createTooltip(y)}</span>`).join('')}</div></div>
                <div class="p-5 rounded-xl bg-cinnabar/10 border border-cinnabar/30"><div class="text-cinnabar text-lg mb-3">忌</div><div class="flex flex-wrap gap-2">${yiji.ji.map(j => `<span class="px-3 py-1 rounded-lg bg-cinnabar/20 text-cinnabar/90 text-sm">${createTooltip(j)}</span>`).join('')}</div></div>
            </div>`;
        }

        // 八字
        function loadBaziContent(container) {
            container.innerHTML = `<div class="space-y-4"><div class="grid grid-cols-2 gap-4"><div><label class="text-parchment/70 text-sm block mb-2">出生日期</label><input type="date" id="baziDate" class="w-full bg-obsidian/50 border border-gold/30 rounded-xl px-4 py-3 text-parchment focus:border-gold focus:outline-none"></div><div><label class="text-parchment/70 text-sm block mb-2">出生时辰</label><select id="baziHour" class="w-full bg-obsidian/50 border border-gold/30 rounded-xl px-4 py-3 text-parchment focus:border-gold focus:outline-none">${diZhi.map((z, i) => `<option value="${i}">${z}时</option>`).join('')}</select></div></div><button onclick="calcBazi()" class="w-full py-3 rounded-xl bg-gradient-to-r from-gold/30 to-bronze/30 border border-gold/50 text-gold hover:from-gold/40 hover:to-bronze/40 transition-all">开始推算</button><div id="baziResult"></div></div>`;
        }
        function calcBazi() {
            const dateVal = document.getElementById('baziDate').value; const hourVal = parseInt(document.getElementById('baziHour').value);
            if (!dateVal) { alert('请选择日期'); return; }
            const date = new Date(dateVal); const lunar = solarToLunar(date.getFullYear(), date.getMonth() + 1, date.getDate());
            const yearGan = tianGan[(lunar.year - 4) % 10]; const yearZhi = diZhi[(lunar.year - 4) % 12];
            const monthGan = tianGan[(lunar.year * 12 + lunar.month + 2) % 10]; const monthZhi = diZhi[(lunar.month + 1) % 12];
            const dayGan = tianGan[(date.getDate() + 5) % 10]; const dayZhi = diZhi[(date.getDate() + 5) % 12];
            const hourGan = tianGan[(date.getDate() * 2 + hourVal) % 10]; const hourZhi = diZhi[hourVal];
            document.getElementById('baziResult').innerHTML = `<div class="grid grid-cols-4 gap-3 mt-4">${[ {t:'年', v: yearGan+yearZhi}, {t:'月', v: monthGan+monthZhi}, {t:'日', v: dayGan+dayZhi}, {t:'时', v: hourGan+hourZhi} ].map(c => `<div class="p-4 rounded-xl bg-gold/10 border border-gold/30 text-center"><div class="text-bronze text-xs">${c.t}柱</div><div class="ancient-font text-2xl text-gold">${c.v}</div></div>`).join('')}</div>`;
        }

        // 姓名
        function loadNameContent(container) {
            container.innerHTML = `<div class="space-y-4"><input type="text" id="nameInput" placeholder="请输入姓名" maxlength="4" class="w-full bg-obsidian/50 border border-gold/30 rounded-xl px-4 py-4 text-parchment text-center text-xl focus:border-gold focus:outline-none"><button onclick="calcName()" class="w-full py-3 rounded-xl bg-gradient-to-r from-gold/30 to-bronze/30 border border-gold/50 text-gold hover:from-gold/40 hover:to-bronze/40 transition-all">开始测算</button><div id="nameResult"></div></div>`;
        }
        function calcName() {
            const name = document.getElementById('nameInput').value.trim(); if (name.length < 2) { alert('请输入至少2个字'); return; }
            const score = Math.floor(Math.random() * 20) + 80;
            document.getElementById('nameResult').innerHTML = `<div class="text-center p-5 rounded-xl bg-gold/10 border border-gold/30 mt-4"><div class="text-gold text-lg mb-2">姓名评分</div><div class="ancient-font text-5xl text-gold text-glow">${score}</div><div class="text-bronze mt-2">${score >= 90 ? '上上签' : '上签'}</div></div>`;
        }

        // 解梦
        function loadDreamContent(container) {
            container.innerHTML = `<div class="space-y-4"><input type="text" id="dreamInput" placeholder="请输入梦境关键词（如：水、龙、蛇）" class="w-full bg-obsidian/50 border border-gold/30 rounded-xl px-4 py-4 text-parchment text-center text-xl focus:border-gold focus:outline-none"><button onclick="interpDream()" class="w-full py-3 rounded-xl bg-gradient-to-r from-gold/30 to-bronze/30 border border-gold/50 text-gold hover:from-gold/40 hover:to-bronze/40 transition-all">解梦</button><div id="dreamResult"></div></div>`;
        }
        function interpDream() {
            const keyword = document.getElementById('dreamInput').value.trim(); if (!keyword) { alert('请输入关键词'); return; }
            const found = dreamDict.find(d => keyword.includes(d.keyword)) || { keyword: keyword, meaning: '此梦寓意深远，需结合个人实际情况解读。', detail: '梦境往往反映内心深处的想法和担忧。建议保持平和心态。' };
            document.getElementById('dreamResult').innerHTML = `<div class="p-5 rounded-xl bg-obsidian/50 border border-gold/20 mt-4"><div class="text-gold text-center text-lg mb-2">${found.meaning}</div><div class="text-parchment/60 text-sm text-center">${found.detail}</div></div>`;
        }

        // 六爻
        function loadLiuyaoContent(container) {
            container.innerHTML = `<div class="text-center space-y-4"><div class="text-parchment/70">请默念你的问题，点击下方铜钱起卦</div><div id="liuyaoCoins" class="flex justify-center space-x-4 text-4xl text-gold/80"><i class="fas fa-circle"></i><i class="fas fa-circle"></i><i class="fas fa-circle"></i></div><button onclick="performLiuyao()" class="px-8 py-3 rounded-xl bg-gradient-to-r from-gold/30 to-bronze/30 border border-gold/50 text-gold">起卦</button><div id="liuyaoResult" class="mt-4"></div></div>`;
        }
        function performLiuyao() {
            const gua = [];
            for(let i=0; i<6; i++) {
                gua.push(Math.random() > 0.5 ? '—' : '- -');
            }
            document.getElementById('liuyaoResult').innerHTML = `<div class="p-4 rounded-xl bg-gold/10 border border-gold/30 inline-block mx-auto"><div class="flex flex-col space-y-1 text-2xl text-gold">${gua.map(l => `<div>${l}</div>`).join('')}</div></div><div class="text-parchment/70 text-sm mt-2">此卦象暗示：顺势而为，静待时机。</div>`;
        }

        // 塔罗
        function loadTarotContent(container) {
            const cards = ['愚者', '魔术师', '女祭司', '女皇', '皇帝', '教皇', '恋人', '战车', '力量', '隐士', '命运之轮', '正义', '倒吊人', '死神', '节制', '恶魔', '塔', '星星', '月亮', '太阳', '审判', '世界'];
            container.innerHTML = `<div class="text-center space-y-4"><div class="text-parchment/70">请静心冥想，选择一张牌</div><div id="tarotCards" class="grid grid-cols-3 gap-4">${Array.from({length: 6}).map(() => `<div onclick="revealTarot()" class="aspect-square rounded-xl bg-gradient-to-br from-mystic to-obsidian border border-gold/30 flex items-center justify-center cursor-pointer hover:border-gold transition-all"><i class="fas fa-star text-gold text-2xl"></i></div>`).join('')}</div><div id="tarotResult"></div></div>`;
        }
        function revealTarot() {
            const cards = ['愚者', '魔术师', '女祭司', '女皇', '皇帝', '教皇', '恋人', '战车', '力量', '隐士', '命运之轮', '正义', '倒吊人', '死神', '节制', '恶魔', '塔', '星星', '月亮', '太阳', '审判', '世界'];
            const meanings = ['新的开始', '创造力', '直觉', '丰盛', '权威', '传统', '选择', '胜利', '勇气', '内省', '命运', '公正', '牺牲', '结束', '平衡', '诱惑', '突变', '希望', '幻觉', '快乐', '觉醒', '完成'];
            const idx = Math.floor(Math.random() * cards.length);
            document.getElementById('tarotResult').innerHTML = `<div class="p-6 rounded-xl bg-gold/10 border border-gold/30 mt-4"><div class="ancient-font text-3xl text-gold mb-2">${cards[idx]}</div><div class="text-parchment">${meanings[idx]}</div></div>`;
        }

        // 风水
        function loadFengshuiContent(container) {
            container.innerHTML = `<div class="flex justify-center mb-6"><div class="relative w-64 h-64"><div class="absolute inset-0 rounded-full border-2 border-gold/30 bagua-rotate"><svg viewBox="0 0 200 200" class="w-full h-full"><text x="100" y="15" text-anchor="middle" fill="#D4AF37" font-size="14">南</text><text x="190" y="105" text-anchor="middle" fill="#D4AF37" font-size="14">西</text><text x="100" y="195" text-anchor="middle" fill="#D4AF37" font-size="14">北</text><text x="10" y="105" text-anchor="middle" fill="#D4AF37" font-size="14">东</text></svg></div><div class="absolute inset-12 rounded-full border border-gold/20 flex items-center justify-center"><div class="text-center"><div class="text-xs text-bronze">今日吉方</div><div class="ancient-font text-2xl text-gold">东南</div></div></div></div></div><div class="grid grid-cols-2 gap-4"><div class="p-4 rounded-xl bg-jade/10 border border-jade/30 text-center"><div class="text-jade text-sm">财神方位</div><div class="text-gold text-lg">正南</div></div><div class="p-4 rounded-xl bg-jade/10 border border-jade/30 text-center"><div class="text-jade text-sm">喜神方位</div><div class="text-gold text-lg">东南</div></div></div>`;
        }

        // ==================== 初始化 ====================
        document.addEventListener('DOMContentLoaded', function() { createParticles('chaosParticles', 150); });
    </script>
</body>
</html>
